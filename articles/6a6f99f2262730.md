---
title: "ãªã‚‹ã¹ãå‹å®‰å…¨ã«vue-routerã®queryã‚’æ ¼ç´ã™ã‚‹"
emoji: "ğŸ›¡ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['typescript', 'vue']
published: true
---
## ã¯ã˜ã‚ã«
`vue-router`ã§ã¯`$route.query`ã‹ã‚‰URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå–å¾—ã§ãã¾ã™ã€‚
```ts
import Vue from 'vue'

class Hoge extends Vue {
  created() {
    const query = this.$route.query // Dictionary<string | (string | null)[]>
  }
}
```

ã“ã®ã¨ã`$route.query`ã¯`Dictionary<string | (string | null)[]>`ã¨ã„ã†å‹ã«ãªã£ã¦ã„ã¾ã™ã€‚`Dictionary`ã¨ã„ã†ã®ã¯`vue-router`ã®ç”¨æ„ã—ã¦ã„ã‚‹å‹ã§ã€ã„ã‚ã‚†ã‚‹é€£æƒ³é…åˆ—ã®ã“ã¨ã§ã™ã€‚
å®Ÿéš›ã®ã¨ã“ã‚å„ã‚­ãƒ¼ã«å¯¾ã—ã¦æ–‡å­—åˆ—ã‹é…åˆ—ã©ã¡ã‚‰ã‹ã ã‘ã‚’å€¤ã¨ã—ã¦è¨±ã—ãŸã„ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ã“ã®ã¾ã¾ã®å‹ã§ã¯ä½¿ã„å‹æ‰‹ãŒã‚ã¾ã‚Šã‚ˆã‚ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚
ãã“ã§å€¤ã‚’å–å¾—ã™ã‚‹ã¨ãã«é©å®œå‹ã‚­ãƒ£ã‚¹ãƒˆã‚’è¡Œã†ã‚ã‘ã§ã™ãŒã€ã“ã‚Œã‚’ãªã‚‹ã¹ãå‹å®‰å…¨ã«è¡Œã†æ–¹æ³•ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã«ã„ãã¤ã‹è€ƒãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯typescript v4.3.2ã§å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚å¤ã„TSã§ã¯å‹æ¨è«–ãŒã†ã¾ãã„ã‹ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚

### ä¾‹å¤–å‡¦ç†ã«ã¤ã„ã¦
å€¤ã‚’å–å¾—ã™ã‚‹æ™‚ã€è¦ä»¶ã«å¿œã˜ã¦ä¾‹å¤–å‡¦ç†ã¨ã—ã¦ã„ãã¤ã‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ä¾‹ãˆã°
1.  ç„¡åŠ¹ãªå€¤ãŒæ¥ãŸå ´åˆ`undefined`ã‚’æ ¼ç´ã—ã¦ãã®ã¾ã¾é€²ã‚ã‚‹
2.  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ç”¨æ„ã—ã¦ç„¡åŠ¹ãªå€¤ãŒæ¥ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æ ¼ç´ã™ã‚‹
3.  ç„¡åŠ¹ãªå€¤ãŒæ¥ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’ã¯ã„ã¦å‡¦ç†ã‚’ã‚„ã‚ã‚‹

ãªã©ã§ã—ã‚‡ã†ã‹ã€‚
ä»Šå›ã¯ã‚ã¾ã‚Šè¤‡é›‘ãªä¾‹å¤–å‡¦ç†ã¯è€ƒãˆãšã€ä¸Šè¨˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã‘è€ƒæ…®ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## å®Ÿè£…ä¾‹
### æ–‡å­—åˆ—ã¨ã—ã¦å–å¾—ã™ã‚‹
#### undefã‚’è¨±å®¹ã—ã¦é…åˆ—ãŒæ¥ãŸå ´åˆä¸€ã¤ç›®ã‚’å–å¾—ã™ã‚‹
```ts
import Vue from 'vue';
interface Params {
  term?: string;
}

function queryToString(value: string | (string | null)[] | undefined): string | undefined {
  return Array.isArray(value) ? value[0] || undefined : value;
}

class Hoge extends Vue {
  params: Params = {};

  created() {
    this.getURLQuery();
  }

  getURLQuery() {
    const query = this.$route.query;
    this.params = {
      term: queryToString(query.term),
    };
  }
}
```
ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã¨æ€ã„ã¾ã™
#### udefã‚’è¨±ã•ãšãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä»£å…¥ã™ã‚‹
ä»¥ä¸‹å‹å¤‰æ›ã®ã¿æ›¸ãå‡ºã—ã¾ã™
```ts
function queryToString(value: string | (string | null)[] | undefined, defaultValue: string): string {
  return Array.isArray(value) ? value[0] || defaultValue : value || defaultValue;
}
```
#### æ–‡å­—åˆ—ãŒæ¥ãŸæ™‚ã®ã¿è¨±å®¹ã€ãã‚Œä»¥å¤–ã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
```ts
function queryToString(value: string | (string | null)[] | undefined): string {
  if (typeof value === 'string' && value) {
    return value;
  }
  throw new Error('Invalid query value');
}
```

ã“ã‚Œä»¥å¤–ã«ã‚‚æ•°å€¤ã¨ã—ã¦ã€é…åˆ—ã¨ã—ã¦æ ¼ç´ã™ã‚‹å ´åˆã‚‚åŒã˜è¦é ˜ã§å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Enumã¨ã—ã¦å–å¾—ã™ã‚‹
Enumã«å«ã¾ã‚Œã‚‹ã‹ã©ã†ã‹ã¯[Object.values](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/values)ã‚’ä½¿ã£ã¦èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™
#### Enumã«è©²å½“ã™ã‚‹æ–‡å­—åˆ—ãŒæ¥ãªã‹ã£ãŸå ´åˆã¯undefã‚’è¿”ã™
```ts
import Vue from 'vue';

enum Genre {
  rock = 'rock',
  jazz = 'jazz',
  progress = 'progress'
}

interface Params {
  genre?: Genre;
}

function queryToEnum<T extends string>(value: string | (string | null)[] | undefined, enumObject: Record<string, T>): T | undefined {
  const temp = Array.isArray(value) ? value[0] : value;
  if ('string' === typeof temp) {
    if (Object.values(enumObject).find((el): boolean => el === temp) !== undefined) {
      return temp as T;
    }
  }
  return undefined; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚„ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™å ´åˆã¯ã“ã“ã‚’å¤‰ãˆã‚‹
}

class Hoge extends Vue {
  params: Params = {};

  created() {
    this.getURLQuery();
  }

  getURLQuery() {
    const query = this.$route.query;
    this.params = {
      genre: queryToEnum(query.genre, Genre)
    };
  }
}

```

#### Enumã®é…åˆ—ã§å–å¾—ã™ã‚‹
è¤‡æ•°é¸æŠã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ã®çµã‚Šè¾¼ã¿æ¡ä»¶ãªã©ã‚’æ ¼ç´ã™ã‚‹å ´åˆã§ã™ã€‚
ã“ã®ã‚³ãƒ¼ãƒ‰ã¯
- Enumã«å«ã¾ã‚Œãªã„å€¤ã¯ç ´æ£„ã™ã‚‹
- é‡è¤‡ã—ãŸå€¤ã¯é™¤å¤–ã™ã‚‹
- è©²å½“ã™ã‚‹ã‚‚ã®ãŒãªã„å ´åˆã¯ç©ºã®é…åˆ—ã‚’æ ¼ç´ã™ã‚‹


ã¨ã„ã†è¦ä»¶ã§ã®ä¾‹ã«ãªã‚Šã¾ã™

```ts
import Vue from 'vue';

enum Genre {
  rock = 'rock',
  jazz = 'jazz',
  progress = 'progress'
}

interface Params {
  genre: Genre[];
}

function queryToEnumArray<T extends string>(value: string | (string | null)[] | undefined, enumObject: Record<string, T>): T[] {
  const enumArray = Object.values(enumObject)
  if (Array.isArray(value)) {
    const result: T[] = [];
    value.forEach((item): void => {
      const test = enumArray.find((el): boolean => { return el === item; });
      if (test && !result.includes(test)) result.push(test);
    });
    return result;
  } else {
    const test = enumArray.find((el): boolean => { return el === value; });
    if (test) return [test];
    return [];
  }
}
class Hoge extends Vue {
  params: Params = {
    genre: []
  };

  created() {
    this.getURLQuery();
  }

  getURLQuery() {
    const query = this.$route.query;
    this.params = {
      genre: queryToEnumArray(query.genre, Genre)
    };
  }
}
```

## ã¾ã¨ã‚
å ´æ‰€ã«ã‚ˆã£ã¦è¦ä»¶ãŒç´°ã‹ãå¤‰ã‚ã£ã¦ãã‚‹å ´åˆã¯ã„ã‚ã„ã‚ã¨é¢å€’ã§ã™ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ã–ã£ãã‚Šè¦ä»¶ã®æ–¹å‘æ€§ãŒæƒãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã§ã‚ã‚Œã°å„ã€…å¤‰æ›ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨æ„ã—ã¦ä½¿ã†ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãã“ã¾ã§å·¥æ•°ã‚’å¢—ã‚„ã•ãšã«å–ã‚Šå»»ã›ã‚‹ã¨æ€ã„ã¾ã™ã€‚